<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>xhr progress</title>
  </head>
  <body style="text-align: center;">
    <progress style="width: 300px; height: 30px;" id="progress" value="0" max="100"></progress><br>
    <span></span>
    <div id="output"></div>
    <script type="text/javascript">
    const span = document.querySelector("span");
    const progress = document.getElementById('progress');
    const output = document.getElementById('output');
      // une fois que le DOM a chargé
      const jsonFile = 'https://ipfs.infura.io/ipfs/QmUncLe1PecbpRANzrg9XW9QGCPwkdipPs8ccrQxe7ud8v'
      document.addEventListener('DOMContentLoaded', () => {
        var oReq = new XMLHttpRequest();

        oReq.open("get", jsonFile, true);
        oReq.send();

        oReq.addEventListener("progress", updateProgress, false);
        oReq.addEventListener("load", transferComplete, false);
        oReq.addEventListener("error", transferFailed, false);
        oReq.addEventListener("abort", transferCanceled, false);

        // ...

        // progression des transferts depuis le serveur jusqu'au client (téléchargement)
        function updateProgress (oEvent) {
          if (oEvent.lengthComputable) {
            var percentComplete = Math.round((oEvent.loaded / oEvent.total) * 100) + "%";
            console.log(percentComplete)
            // ...
          } else {
            // Impossible de calculer la progression puisque la taille totale est inconnue
            console.log("Impossible de calculer la progression puisque la taille totale est inconnue")
          }
        }

        function transferComplete(evt) {
          alert("Le transfert est terminé.");
        }

        function transferFailed(evt) {
          alert("Une erreur est survenue pendant le transfert du fichier.");
        }

        function transferCanceled(evt) {
          alert("Le transfert a été annulé par l'utilisateur.");
        }
      }); // end of DOMContentLoaded

    </script>
  </body>
</html>
